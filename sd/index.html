<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"
        integrity="sha512-f0VlzJbcEB6KiW8ZVtL+5HWPDyW1+nJEjguZ5IVnSQkvZbwBt2RfCBY0CBO1PsMAqxxrG4Di6TfsCPP3ZRwKpA=="
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


    <title>SoundArt WebApp</title>
</head>

<body>

    <h1>SoundArt WebApp</h1>


    <div class="container" id="volumesController">

        <div class="row m-2 align-middle">
            <h3 class="col-3 m-2">Volumi</h3>
            <button class="btn btn-primary col-5" type="button" data-toggle="collapse" data-target="#collapseExample"
                aria-expanded="false" aria-controls="collapseExample">
                Impostazioni
            </button>
        </div>
        <div class="collapse m-2" id="collapseExample">
            <div class="card card-body col-10">
                <ul class="list-group" id="audioList">

                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <h5>Aggiungi Audio</h5>
                        <button class="btn btn-light btn-sm" type="button" data-toggle="collapse"
                            data-target="#addSoundCollapse" aria-expanded="false" aria-controls="addSoundCollapse">
                            Aggiungi </button>
                    </li>
                    <div class="collapse" id="addSoundCollapse">
                        <div class="card card-body">
                            <input class="form-control m2" type="file" id="aggiungiFormFile" />
                            <div class="row">
                                <div class="col-md-4 col-lg-2">
                                    <button class="btn btn-primary mt-1 btn-block" onclick="UploadFile()">
                                        Upload</button>
                                </div><!-- /col -->
                            </div><!-- /row -->
                        </div>
                    </div>

                </ul>
            </div>
        </div>

    </div>





    <script>
        function CreateControls() {
            for (let i = 0; i < nOfDevices; i++) {
                //creates the row with the volume range
                let box = document.createElement("div");
                box.className = "row border shadow p-3 mb-3 bg-body rounded";
                document.getElementById("volumesController").appendChild(box);


                let maincol1 = document.createElement("div");
                maincol1.className = "col-8 align-self-center";
                let maincol2 = document.createElement("div");
                maincol2.className = "col-2 align-self-center";
                let maincol3 = document.createElement("div");
                maincol3.className = "col align-self-center";



                let row = document.createElement("div");
                row.className = "row";
                maincol1.appendChild(row);

                box.appendChild(maincol1); box.appendChild(maincol2); box.appendChild(maincol3);





                /* maincol 1*/
                let text = document.createElement("h5"); text.className = "col-5"
                text.textContent = "Device " + i;
                let testButton = document.createElement("label"); testButton.type = "button";
                testButton.className = "btn btn-primary col-3";
                testButton.onclick = function () { SendXhrPOST("test/device=" + i); };
                let testButtonIcon = document.createElement("i"); testButtonIcon.className = "material-icons";
                testButtonIcon.textContent = "phonelink_ring";
                testButton.appendChild(testButtonIcon);

                row.appendChild(text); row.appendChild(testButton);


                let col1 = document.createElement("div");
                col1.className = "col-10";
                let col2 = document.createElement("div");
                col2.className = "col";
                row.appendChild(col1); row.appendChild(col2);



                let input = document.createElement("input");
                input.type = "range"; input.id = "volumeRange" + i; input.className = "form-range col-8";
                input.onchange = function () { SendXhrPOST("setVolume/device=" + i + "&volume=" + input.value); };
                let value = document.createElement("span");
                value.className = "badge bg-secondary col"; value.textContent = input.value;
                input.oninput = function () { value.textContent = input.value; };
                col1.appendChild(input); col2.appendChild(value);



                /* maincol2 */
                let dropDownDiv = document.createElement("div"); dropDownDiv.className = "dropdown";
                maincol2.appendChild(dropDownDiv);

                let sButton = document.createElement("button");
                sButton.type = "button"; sButton.className = "btn btn-secondary dropdown-toggle"; sButton.textContent = "Suono";
                sButton.setAttribute("data-bs-toggle", "dropdown"); sButton.setAttribute("aria-expanded", "false");
                sButton.id = "dropdownMenuButton" + i;
                dropDownDiv.appendChild(sButton);




                let dropdownItem = document.createElement("ul"); dropdownItem.className = "dropdown-menu";
                dropdownItem.setAttribute("aria-labelledby", "dropdownMenuButton" + i);
                for (let audio of audios) {
                    let li = document.createElement("li");
                    li.id = "dropDownSoundList" + i + audio;
                    //alert("dropDownSoundList" + i + "Item" + audios[j].id)
                    li.className = "dropdown-item";
                    li.textContent = audio;// appendChild(document.createTextNode(audios[j]));
                    li.onclick = function () { SendXhrPOST("setAudio/device=" + i + "&audio=" + audio); };
                    dropdownItem.appendChild(li);
                }

                dropDownDiv.appendChild(dropdownItem);



                /*maincol3*/
                let checkBoxForm = document.createElement("div"); checkBoxForm.className = "form-check";
                let checkBox = document.createElement("input"); checkBox.className = "form-check-input"; checkBox.type = "checkbox";
                checkBox.id = "flexCheckChecked" + i;
                checkBox.onchange = function () {
                    SendXhrPOST("setVolume/device=" + i + "&loop=" + (checkBox.checked ? "1" : "0"));
                };
                let label = document.createElement("label"); label.className = "form-check-label"; label.setAttribute("for", "flexCheckChecked" + i);
                label.textContent = "Loop";
                checkBoxForm.appendChild(checkBox); checkBoxForm.appendChild(label);
                maincol3.appendChild(checkBoxForm);

            }
        }




        function CreateSettings() {
            let audioList = document.getElementById("audioList");

            for (let audio of audios) {
                let li = document.createElement("li");
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                let liText = document.createElement("h5"); liText.textContent = audio;
                //liText.contentEditable = true;
                //liText.onclose = function() {alert("diocan");}
                //let divButtons = document.createElement("div");
                //divButtons.className = "btn-group"; divButtons.setAttribute("role", "group"); 
                //li.appendChild(divButtons);

                /*
                <div class="btn-group" role="group" aria-label="Basic example">
                            <button type="button" class="btn btn-secondary">Modifica</button>
                            <button type="button" class="btn btn-danger">Elimina</button>
                </div>
                */
                let liDelButton = document.createElement("button"); liDelButton.className = "btn btn-danger btn-sm";
                liDelButton.onclick = function () {
                    li.remove();

                    for (let j = 0; j < nOfDevices; j++) {
                        let aux = $("#dropDownSoundList" + j + audio);
                        //alert("dropDownSoundList" + j + " " + audio + " i: " + audios.indexOf(audio));
                        if (aux.text() == audio) {
                            //alert("deleting " + audio + " for list " + j );
                            aux.remove();
                        }

                    }
                    audios.splice(audios.indexOf(audio), 1);
                    SendXhrPOST("/deleteAudio/audio=" + audio);
                }
                liDelButton.textContent = "Elimina";
                li.appendChild(liText); li.appendChild(liDelButton);
                audioList.appendChild(li);

            }


        }

        function SendXhrPOST(str) {
            let xhr = new XMLHttpRequest();
            xhr.open('POST', str, true);
            xhr.send();
        }

        function UploadFile() {

            let fileInput = document.getElementById('aggiungiFormFile');
            let file = fileInput.files[0];

            let xhr = new XMLHttpRequest();
            //xhr.upload.addEventListener('progress', onprogressHandler, false);
            xhr.open('POST', '/upload/uri', true);

            let formData = new FormData();
            formData.append('thefile', file);
            xhr.send(formData);

        }

        //nOfDevices [DO NOT DELETE THIS COMMENT]
        var nOfDevices = 1;
        var audios = ["audio1", "audio2", "audio3", "audio4"];
        if (nOfDevices == 0) {
            let div = document.createElement("div");
            document.body.appendChild (document.createTextNode("Nessun Dispositivo"));
            document.getElementById("volumesController").hidden = true;
        } else {
            CreateControls();
            CreateSettings();
        }
    </script>
</body>

</html>